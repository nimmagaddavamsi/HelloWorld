import java.sql.*;

public class Db2DynamicColumnTransfer {
    // Source DB2 (Non-Prod) connection details
    private static final String SOURCE_DB_URL = "jdbc:odbc:SourceDSN";
    private static final String SOURCE_DB_USER = "sourceUsername";
    private static final String SOURCE_DB_PASSWORD = "sourcePassword";

    // Destination DB2 (Non-Prod) connection details
    private static final String DEST_DB_URL = "jdbc:odbc:DestinationDSN";
    private static final String DEST_DB_USER = "destUsername";
    private static final String DEST_DB_PASSWORD = "destPassword";

    public static void main(String[] args) {
        Connection sourceConnection = null;
        Connection destConnection = null;
        PreparedStatement selectStatement = null;
        PreparedStatement insertStatement = null;
        ResultSet resultSet = null;

        try {
            // Connect to the source Db2 database
            sourceConnection = DriverManager.getConnection(SOURCE_DB_URL, SOURCE_DB_USER, SOURCE_DB_PASSWORD);
            System.out.println("Connected to the source database successfully!");

            // Connect to the destination Db2 database
            destConnection = DriverManager.getConnection(DEST_DB_URL, DEST_DB_USER, DEST_DB_PASSWORD);
            System.out.println("Connected to the destination database successfully!");

            // SELECT query with WHERE condition on the source database
            String selectQuery = "SELECT * FROM source_table WHERE column3 = ?";
            selectStatement = sourceConnection.prepareStatement(selectQuery);
            selectStatement.setString(1, "specificCondition"); // Set the condition dynamically
            resultSet = selectStatement.executeQuery();

            // Get metadata from ResultSet
            ResultSetMetaData metaData = resultSet.getMetaData();
            int columnCount = metaData.getColumnCount();

            // Dynamically construct the INSERT query based on column metadata
            StringBuilder insertQueryBuilder = new StringBuilder("INSERT INTO destination_table (");
            StringBuilder valuesBuilder = new StringBuilder(" VALUES (");

            for (int i = 1; i <= columnCount; i++) {
                insertQueryBuilder.append(metaData.getColumnName(i));
                valuesBuilder.append("?");
                if (i < columnCount) {
                    insertQueryBuilder.append(", ");
                    valuesBuilder.append(", ");
                }
            }
            insertQueryBuilder.append(")").append(valuesBuilder).append(")");

            String insertQuery = insertQueryBuilder.toString();
            insertStatement = destConnection.prepareStatement(insertQuery);

            // Process the results and insert into destination table
            while (resultSet.next()) {
                for (int i = 1; i <= columnCount; i++) {
                    insertStatement.setObject(i, resultSet.getObject(i));
                }
                insertStatement.executeUpdate();
                System.out.println("Inserted a row into the destination table.");
            }
        } catch (SQLException e) {
            System.out.println("Error occurred during database operation.");
            e.printStackTrace();
        } finally {
            // Close resources
            try {
                if (resultSet != null) resultSet.close();
                if (selectStatement != null) selectStatement.close();
                if (insertStatement != null) insertStatement.close();
                if (sourceConnection != null) sourceConnection.close();
                if (destConnection != null) destConnection.close();
                System.out.println("Connections closed.");
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
}
